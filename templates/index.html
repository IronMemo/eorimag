<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Eorimag – Cod EORI 100% online</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <main class="layout-two-col">
    <!-- Stânga: bandă albastră (instituțional) -->
    <section class="left-info">
      <div class="brand">
        <img src="{{ url_for('static', filename='logo-eorimag.png') }}" alt="Eorimag logo" class="logo-img">
        <h1>Cod EORI – simplu, 100% online</h1>
        <p class="tagline">
          Platformă digitală pentru obținerea rapidă a codului EORI, cu semnătură electronică integrată.
        </p>
        <ul class="benefits">
          <li>✔️ Formulare clare, pași ghidați</li>
          <li>✔️ Încarci actele direct din telefon</li>
          <li>✔️ Semnătură digitală inclusă</li>
          <li>✔️ Confirmare pe email</li>
        </ul>
      </div>
    </section>

    <!-- Dreapta: FORMULAR -->
    <section class="right-form card">
      <form id="orderForm">
        <div class="service-grid" id="serviceGrid" role="radiogroup">
          <input type="hidden" name="service_key" id="service_key" value="eori_ro">
          <button type="button" class="service-card selected" data-key="eori_ro">EORI România</button>
          <button type="button" class="service-card" data-key="eori_update">Actualizare EORI</button>
          <button type="button" class="service-card" data-key="gb_eori">GB EORI (UK)</button>
          <button type="button" class="service-card" data-key="resend">Retrimitere documente</button>
        </div>

        <div class="grid form-grid">
          <label>Nume complet*<input name="full_name" required></label>
          <label>Email*<input type="email" name="email" required></label>
          <label>Telefon*<input name="phone" required></label>
          <label>CNP/CUI*<input name="cnp_cui" required></label>
        </div>

        <div class="uploads">
          <div><span>Carte identitate (față)</span><input type="file" name="id_front" accept=".pdf,.jpg,.jpeg,.png"></div>
          <div><span>Carte identitate (verso) – opțional</span><input type="file" name="id_back" accept=".pdf,.jpg,.jpeg,.png"></div>
          <div><span>Document suplimentar – opțional</span><input type="file" name="extra_doc" accept=".pdf,.jpg,.jpeg,.png"></div>
        </div>

        <!-- Semnătură -->
        <div class="signature-block">
          <div class="sig-header">
            <strong>Semnătură</strong>
            <span class="muted">Semnează cu mouse-ul sau degetul (pe telefon)</span>
          </div>
          <div class="sig-wrap"><canvas id="sigpad" width="600" height="200"></canvas></div>
          <div class="sig-actions">
            <button type="button" id="sigClear" class="secondary">Șterge</button>
            <button type="button" id="sigUndo" class="secondary">Undo</button>
          </div>
          <input type="hidden" name="signature_data" id="signature_data">
        </div>

        <button type="submit" id="payBtn">Plătește</button>
        <p id="msg" class="muted"></p>
      </form>
    </section>
  </main>

  <script>
    const serviceInput=document.getElementById('service_key');
    document.querySelectorAll('.service-card').forEach(btn=>{
      btn.onclick=()=>{document.querySelectorAll('.service-card').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');serviceInput.value=btn.dataset.key;}
    });

    const canvas=document.getElementById('sigpad');
    const ctx=canvas.getContext('2d');
    let drawing=false,points=[],strokes=[];
    function getPos(e){const r=canvas.getBoundingClientRect();if(e.touches)return{x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top};return{x:e.clientX-r.left,y:e.clientY-r.top};}
    function redraw(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.lineWidth=2;ctx.lineCap='round';ctx.strokeStyle='#000';strokes.forEach(s=>{ctx.beginPath();s.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));ctx.stroke();});if(points.length){ctx.beginPath();points.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));ctx.stroke();}}
    canvas.onmousedown=e=>{drawing=true;points=[];strokes.push(points);points.push(getPos(e));redraw();};
    canvas.onmousemove=e=>{if(!drawing)return;points.push(getPos(e));redraw();};
    window.onmouseup=()=>drawing=false;
    canvas.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;points=[];strokes.push(points);points.push(getPos(e));redraw();});
    canvas.addEventListener('touchmove',e=>{e.preventDefault();if(!drawing)return;points.push(getPos(e));redraw();});
    canvas.addEventListener('touchend',()=>drawing=false);
    document.getElementById('sigClear').onclick=()=>{strokes=[];points=[];redraw();};
    document.getElementById('sigUndo').onclick=()=>{strokes.pop();redraw();};

    const form=document.getElementById('orderForm'),msg=document.getElementById('msg'),btn=document.getElementById('payBtn'),sigHidden=document.getElementById('signature_data');
    form.onsubmit=async e=>{
      e.preventDefault();msg.textContent='';btn.disabled=true;
      sigHidden.value=strokes.length?canvas.toDataURL('image/png'):'';
      try{const fd=new FormData(form);const r=await fetch('/create-checkout',{method:'POST',body:fd});const d=await r.json();if(!r.ok)throw new Error(d.error||'Eroare');window.location.href=d.checkout_url;}catch(err){msg.textContent=err.message;btn.disabled=false;}
    };
  </script>
</body>
</html>
